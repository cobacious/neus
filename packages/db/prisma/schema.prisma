generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Article {
  id                 String                     @id @default(cuid())
  url                String                     @unique
  title              String
  snippet            String?
  content            String?
  source             String
  sourceId           String
  sourceRel          Source                     @relation(fields: [sourceId], references: [id])
  publishedAt        DateTime
  updatedAt          DateTime?
  author             String?
  categories         String?
  rawHtml            String?
  embedding          Json?
  createdAt          DateTime                   @default(now())
  clusterAssignments ArticleClusterAssignment[]
}

model Cluster {
  id                 String                     @id @default(cuid())
  createdAt          DateTime                   @default(now())
  label              String?
  origin             String
  headline           String?
  summary            String?
  embedding          Json?
  score              Float?                     @default(0)
  articleAssignments ArticleClusterAssignment[]
}

model Source {
  id            String    @id @default(cuid())
  name          String
  domain        String?
  homepageUrl   String?
  rssFeedUrl    String    @unique
  faviconUrl    String?
  active        Boolean   @default(true)
  trustScore    Float?    @default(0)
  lastFetchedAt DateTime?
  articles      Article[]
}

model ArticleClusterAssignment {
  id         String   @id @default(cuid())
  articleId  String   @unique
  clusterId  String
  similarity Float?
  method     String
  createdAt  DateTime @default(now())
  cluster    Cluster  @relation(fields: [clusterId], references: [id])
  article    Article  @relation(fields: [articleId], references: [id])

  @@unique([articleId, clusterId])
}
